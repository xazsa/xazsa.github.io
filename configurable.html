<!DOCTYPE html>
<html>
<head>
<title>Configurable</title>
<meta charset="utf-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="css.css">
</head>
<body>
<a name="pagetop"></a>
<H1>Tekura Setting</H1>

<a name="start_year"></a>
Start Year(ex.Heisei→1989）<br>
<div align="center">
<input type="text" size="5" maxlength="4" id="lc_year"><br>
</div>
<a name="id_text"></a>
ID Text (ex.Heisei→H）<br>
<div align="center">
<input type="text" size="5" maxlength="2" id="lc_id_text"><br>
</div>
<hr>
<div align="center">
<input type="reset" id='cancel_button' value="CANCEL">
<input type="submit" id='submit_button' value="SUBMIT"><br>
</div>
<hr>
<div align="center">
<input type="button" id='reset_button' value="RESET">
</div>
<script>
    //alert("#"+ window.location.search.substring(1)+"#");
    if(window.location.search.substring(1) != ""){
        var options = JSON.parse(decodeURIComponent(window.location.search.substring(1)));
        //alert(JSON.stringify(options));
        if (options.lc_year) {
            var obj = document.getElementById("lc_year");
            obj.value = options.lc_year;
        }
        if (options.lc_id_text) {
            var obj = document.getElementById("lc_id_text");
            obj.value = options.lc_id_text;
        }
    }

    function isAlpabet(str){
        str = (str==null)?"":str;
        if(str.match(/^[A-Za-z0-9]*$/)){
            return true;
        }else{
            return false;
        }
    }

    cancel_button.addEventListener('click', function() {
        document.location = 'pebblejs://close';
    });

    submit_button.addEventListener('click', function() {
        // Get the config data from the UI elements
        
        var lc_year = document.getElementById('lc_year').value;
        if(isNaN(lc_year)){
            alert('Start year is not number:'+lc_year);
            location.hash='start_year';
            return;    
        }

        var lc_id_text = document.getElementById('lc_id_text').value;
        if(isAlpabetlc_id_text){
            alert('ID Text only use Alpabet:'+lc_id_text);
            location.hash='id_text';
            return;
        }
        // Make a data object to be sent, coercing value types to integers
        var options = {
        'lc_year': parseInt(lc_year,10),
        'lc_id_text': lc_id_text
        };

        // Determine the correct return URL (emulator vs real watch)
        function getQueryParam(variable, defaultValue) {
        var query = location.search.substring(1);
        var vars = query.split('&');
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split('=');
            if (pair[0] === variable) {
            return decodeURIComponent(pair[1]);
            }
        }
        return defaultValue || false;
        }
        var return_to = getQueryParam('return_to', 'pebblejs://close#');

        // Encode and send the data when the page closes
        document.location = return_to + encodeURIComponent(JSON.stringify(options));
    });

    reset_button.addEventListener('click', function() {
        document.getElementById("lc_year").value = 1989;
        document.getElementById("lc_id_text").value = "H";
        location.hash='pagetop';
    });
</script>
  </body>
</html>
